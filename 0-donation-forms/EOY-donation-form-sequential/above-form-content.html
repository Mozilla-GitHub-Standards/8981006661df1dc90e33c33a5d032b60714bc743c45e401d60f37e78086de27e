<!-- =================== Above form content STARTS =================== -->
<div class="sequential-container">

<div id="form-wrapper">
<form id="donation-form-sequential" action="/page/cde/Contribution/Charge" method="post" data-parsley-excluded="input[type=button], input[type=submit], input[type=reset], input[type=hidden], [disabled]">
<ol class="progress">
  <li data-position="#page-1" class="active">
    <div>{{Amount}}</div>
    <div class="page-breadcrumb"></div>
  </li>
  <li data-position="#page-2">
    <div>{{Payment}}</div>
    <div class="page-breadcrumb"></div>
  </li>
  <li data-position="#page-3">{{Personal}}</li>
</ol>
<!-- = Amount Section ====================  -->
<fieldset id="page-1" class="sequence-page">
  <div class="row">
    <div class="full">
      <h2>{{Donate-now}}</h2>
      <p class="currency-display">{{currency_display}}</p>
    </div>
  </div>

  <div class="row donation-amount-row hidden-visibility">
    <div class="third">
      <input type="radio" name="donation_amount" value="20" id="amount-20" data-parsley-multiple="donation_amount" data-parsley-group="page-1" data-parsley-errors-container="#amount-error-msg" data-parsley-error-message="{{Please-select-an-amount}}." required=""><label for="amount-20" class="large-label-size">$20</label>
    </div>
    <div class="third">
      <input type="radio" name="donation_amount" value="10" id="amount-10" data-parsley-multiple="donation_amount" data-parsley-group="page-1"><label for="amount-10" class="large-label-size">$10</label>
    </div>
    <div class="third">
      <input type="radio" name="donation_amount" value="5" id="amount-5" data-parsley-multiple="donation_amount" data-parsley-group="page-1"><label for="amount-5" class="large-label-size">$5</label>
    </div>
  </div>
  <div class="row donation-amount-row hidden-visibility">
    <div class="third">
      <input type="radio" name="donation_amount" value="3" id="amount-3" data-parsley-multiple="donation_amount" data-parsley-group="page-1"><label for="amount-3" class="large-label-size">$3</label>
    </div>
    <div class="two-third">
      <div id="amount-other-container">
        <input type="radio" name="donation_amount" value="other" id="amount-other" data-parsley-multiple="donation_amount" data-parsley-group="page-1"><label for="amount-other" class="large-label-size">$</label>
        <input name="donation_amount_other" placeholder="{{Other-amount}}" class="medium-label-size" data-parsley-multiple="donation_amount" data-parsley-group="page-1" data-parsley-errors-container="#amount-other-error-msg" data-parsley-type="number" data-parsley-check-amount data-parsley-min="2">
      </div>
    </div>
  </div>
  <div class="row error-msg-row">
    <div class="full">
      <div id="amount-error-msg"></div>
      <div id="amount-other-error-msg"></div>
    </div>
  </div>
  <div class="row" id="recurring-option-row">
    <div class="half">
      <input type="radio" name="recurring_acknowledge" value="0" checked="checked" id="one-time-payment" data-parsley-multiple="recurring_acknowledge" data-parsley-group="page-1" data-parsley-errors-container="#recurring-error-msg" required=""><label for="one-time-payment" class="medium-label-size">{{One-time}}</label>
    </div>
    <div class="half">
      <input type="radio" name="recurring_acknowledge" value="1" id="monthly-payment" data-parsley-multiple="recurring_acknowledge" data-parsley-group="page-1"><label for="monthly-payment" class="medium-label-size">{{Monthly}}</label>
    </div>
  </div>
  <div class="row error-msg-row">
    <div class="full">
      <div id="recurring-error-msg"></div>
    </div>
  </div>
  <a href="#page-2" data-button-type="next" data-page="1" class="button">
    {{Next}}
  </a>
</fieldset>
<!-- = Amount Section Ends ====================  -->
<!-- = Payment Section ====================  -->
<fieldset id="page-2" class="sequence-page page-hidden-incomplete hidden" disabled>
  <div class="row">
    <div class="full">
      <h2>{{Payment}}</h2>

      <p id="secure-label"><i class="fa fa-lock"></i>{{Secure}}</p>
    </div>
  </div>
  <div class="row" id="payment-type-row">
    <div class="half">
      <input type="radio" name="payment-type" value="cc" id="payment-cc" data-parsley-group="page-2" data-parsley-multiple="payment-type" data-parsley-group="payment-type" data-parsley-errors-container="#payment-type-error-msg" required=""><label for="payment-cc">
      <div class="row payment-logos credit-card-logos">
        <p>&nbsp;</p>
      </div>
      <div class="row medium-label-size">{{Credit-card}}</div>
    </label>
    </div>
    <div class="half">
      <input type="radio" name="payment-type" value="paypal" id="payment-paypal" data-parsley-group="page-2" data-parsley-multiple="payment-type" data-parsley-group="payment-type" data-parsley-errors-container="#payment-type-error-msg" required=""><label for="payment-paypal">
      <div class="row payment-logos paypal-logo">
        <p>&nbsp;</p>
      </div>
      <div class="row medium-label-size">PayPal</div>
    </label>
    </div>
  </div>
  <!-- Credit Card Info -->
  <div class="cc-additional-info credit-card-section">
    <div class="row">
      <div class="full">
        <div class="field-container">
          <i class="fa fa-credit-card field-icon"></i>
          <input type="tel" name="cc_number" placeholder="{{Credit-card-number}}" maxlength="16" data-parsley-group="page-2" data-parsley-visa-mc-card-num="" required="">
        </div>
      </div>
    </div>
    <div class="row hint-msg-parent">
      <div class="half">
        <div class="field-container">
          <i class="fa fa-calendar-o field-icon"></i>
          <input aria-label="{{Credit-Card-Expiration-Month}}" type="tel" placeholder="{{MM}}" pattern="\d{2}" maxlength="2" data-parsley-group="page-2" data-parsley-type="digits" required="" name="cc_expir_month">
          /
          <input aria-label="{{Credit-Card-Expiration-Year}}" type="tel" placeholder="{{YY}}" pattern="\d{2}" maxlength="2" data-parsley-group="page-2" data-parsley-type="digits" required="" name="cc_expir_year">
        </div>
      </div>
      <div class="half">
        <div class="field-container">
          <i class="fa fa-lock field-icon"></i>
          <input type="tel" name="cc_cvv" maxlength="4" placeholder="{{CVC}}" data-parsley-group="page-2" data-parsley-type="digits" required=""><i class="fa fa-question-circle hint"></i>
        </div>
      </div>
      <div class="full">
        <div class="hint-msg small">
          <img src="https://ddz69tinzt56n.cloudfront.net/images/CVC-illustration.png" class="left">

          <div class="">{{cvc-info}}.</div>
        </div>
      </div>
    </div>
    <a href="#page-3" class="button" data-page="2" data-button-type="next">
      {{Next}}
    </a>
  </div>
  <!-- Credit Card Info Ends -->
  <div class="row error-msg-row">
    <div class="full">
      <div id="payment-type-error-msg"></div>
    </div>
  </div>

</fieldset>
<!-- = Payment Section Ends ====================  -->

<!-- = Billing Info Section ====================  -->
<fieldset id="page-3" class="sequence-page page-hidden-incomplete hidden" disabled>
<div class="row">
  <div class="full">
    <h2>{{Personal}}</h2>
  </div>
</div>
<div class="billing-info">
<!-- Full Name Row  -->
<div class="row cc-additional-info" id="full-name-row">
  <div class="half">
    <div class="field-container">
      <i class="fa fa-user field-icon"></i>
      <input type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" name="firstname" placeholder="{{First-name}}" data-parsley-group="page-3" required="">
    </div>
  </div>
  <div class="half">
    <div class="field-container">
      <input type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" name="lastname" placeholder="{{Last-name}}" data-parsley-group="page-3" class="less-indented" required="">
    </div>
  </div>
</div>
<!-- Full Name Row Ends  -->
<!-- Address -->
<div class="cc-additional-info address-section">

<div class="row">
  <div class="full">
    <div class="field-container">
      <i class="fa fa-map-marker field-icon"></i>
      <select name="country"data-parsley-group="page-3"  required="" >
        <option value="">Country</option>
      </select></div>
  </div>
</div>
<div class="row">
  <div class="full">
    <input type="text" name="addr1" placeholder="{{Address}}" data-parsley-group="page-3" required=""></div>
</div>
<div class="row">
  <div class="half">
    <input type="text" name="city" placeholder="{{City}}" data-parsley-group="page-3" required=""></div>
  <div class="half">
    <input type="text" name="zip" placeholder="{{Postal-code}}" class="less-indented" data-parsley-group="page-3" required="">
  </div>
</div>
<div class="row">
<div class="full">
<select id="wsstate_cd" name="state_cd" autocomplete="billing region" class="">
  <option selected="selected" value="">{{State-Province}}</option>
</select>
<select class="states-select" data-country="none">
  <option value="" data-value="none">None</option>
</select>
<select class="states-select" data-country="US">
  <optgroup label="U.S. States and Territories">
    <option value="AL">Alabama</option>
    <option value="AK">Alaska</option>
    <option value="AS">American Samoa</option>
    <option value="AZ">Arizona</option>
    <option value="AR">Arkansas</option>
    <option value="AA">Armed Forces Americas</option>
    <option value="AE">Armed Forces Europe</option>
    <option value="AP">Armed Forces Pacific</option>
    <option value="CA">California</option>
    <option value="CO">Colorado</option>
    <option value="CT">Connecticut</option>
    <option value="DE">Delaware</option>
    <option value="DC">District of Columbia</option>
    <option value="FL">Florida</option>
    <option value="GA">Georgia</option>
    <option value="GU">Guam</option>
    <option value="HI">Hawaii</option>
    <option value="ID">Idaho</option>
    <option value="IL">Illinois</option>
    <option value="IN">Indiana</option>
    <option value="IA">Iowa</option>
    <option value="KS">Kansas</option>
    <option value="KY">Kentucky</option>
    <option value="LA">Louisiana</option>
    <option value="ME">Maine</option>
    <option value="MH">Marshall Islands</option>
    <option value="MD">Maryland</option>
    <option value="MA">Massachusetts</option>
    <option value="MI">Michigan</option>
    <option value="FM">Micronesia</option>
    <option value="MN">Minnesota</option>
    <option value="UM">Minor Outlying Islands</option>
    <option value="MS">Mississippi</option>
    <option value="MO">Missouri</option>
    <option value="MT">Montana</option>
    <option value="NE">Nebraska</option>
    <option value="NV">Nevada</option>
    <option value="NH">New Hampshire</option>
    <option value="NJ">New Jersey</option>
    <option value="NM">New Mexico</option>
    <option value="NY">New York</option>
    <option value="NC">North Carolina</option>
    <option value="ND">North Dakota</option>
    <option value="MP">Northern Mariana Islands</option>
    <option value="OH">Ohio</option>
    <option value="OK">Oklahoma</option>
    <option value="OR">Oregon</option>
    <option value="PW">Palau</option>
    <option value="PA">Pennsylvania</option>
    <option value="PR">Puerto Rico</option>
    <option value="RI">Rhode Island</option>
    <option value="SC">South Carolina</option>
    <option value="SD">South Dakota</option>
    <option value="TN">Tennessee</option>
    <option value="TX">Texas</option>
    <option value="UT">Utah</option>
    <option value="VT">Vermont</option>
    <option value="VI">Virgin Islands</option>
    <option value="VA">Virginia</option>
    <option value="WA">Washington</option>
    <option value="WV">West Virginia</option>
    <option value="WI">Wisconsin</option>
    <option value="WY">Wyoming</option>
  </optgroup>
</select>
<select class="states-select" data-country="AU">
  <optgroup label="Australian States">
    <option value="Australian Capital Territory">Australian Capital
      Territory
    </option>
    <option value="New South Wales">New South Wales</option>
    <option value="Northern Territory">Northern Territory</option>
    <option value=Queensland>Queensland</option>
    <option value="South Australia">South Australia</option>
    <option value="Tasmania">Tasmania</option>
    <option value="Victoria">Victoria</option>
    <option value="Western Australia">Western Australia</option>
  </optgroup>
</select>
<select class="states-select" data-country="BR">
  <optgroup label="Brazilian States">
    <option value="AC">Acre</option>
    <option value="AL">Alagoas</option>
    <option value="AM">Amazonas</option>
    <option value="AP">Amapá</option>
    <option value="BA">Bahia</option>
    <option value="CE">Ceará</option>
    <option value="DF">Distrito Federal</option>
    <option value="ES">Espírito Santo</option>
    <option value="GO">Goiás</option>
    <option value="MA">Maranhão</option>
    <option value="MT">Mato Grosso</option>
    <option value="MS">Mato Grosso do Sul</option>
    <option value="MG">Minas Gerais</option>
    <option value="PA">Pará</option>
    <option value="PB">Paraíba</option>
    <option value="PR">Paraná</option>
    <option value="PE">Pernambuco</option>
    <option value="PI">Piauí</option>
    <option value="RJ">Rio de Janeiro</option>
    <option value="RN">Rio Grande do Norte</option>
    <option value="RO">Rondônia</option>
    <option value="RS">Rio Grande do Sul</option>
    <option value="RR">Roraima</option>
    <option value="SC">Santa Catarina</option>
    <option value="SE">Sergipe</option>
    <option value="SP">São Paulo</option>
    <option value="TO">Tocantins</option>
  </optgroup>
</select>
<select class="states-select" data-country="CA">
  <optgroup label="Canadian Provinces">
    <option value="Alberta">Alberta</option>
    <option value="British Columbia">British Columbia</option>
    <option value="Manitoba">Manitoba</option>
    <option value="New Brunswick">New Brunswick</option>
    <option value="Newfoundland and Labrador">Newfoundland and
      Labrador
    </option>
    <option value="Northwest Territories">Northwest Territories
    </option>
    <option value="Nova Scotia">Nova Scotia</option>
    <option value="Nunavut">Nunavut</option>
    <option value="Ontario">Ontario</option>
    <option value="Prince Edward Island">Prince Edward Island</option>
    <option value="Quebec">Quebec</option>
    <option value="Saskatchewan">Saskatchewan</option>
    <option value="Yukon">Yukon</option>
  </optgroup>
</select>
<select class="states-select" data-country="IE">
  <optgroup label="Irish Counties">
    <option value="Antrim">Antrim</option>
    <option value="Armagh">Armagh</option>
    <option value="Carlow">Carlow</option>
    <option value="Cavan">Cavan</option>
    <option value="Clare">Clare</option>
    <option value="Cork">Cork</option>
    <option value="Derry">Derry</option>
    <option value="Donegal">Donegal</option>
    <option value="Down">Down</option>
    <option value="Dublin">Dublin</option>
    <option value="Fermanagh">Fermanagh</option>
    <option value="Galway">Galway</option>
    <option value="Kerry">Kerry</option>
    <option value="Kildare">Kildare</option>
    <option value="Kilkenny">Kilkenny</option>
    <option value="Laois">Laois</option>
    <option value="Leitrim">Leitrim</option>
    <option value="Limerick">Limerick</option>
    <option value="Longford">Longford</option>
    <option value="Louth">Louth</option>
    <option value="Mayo">Mayo</option>
    <option value="Meath">Meath</option>
    <option value="Monaghan">Monaghan</option>
    <option value="Offaly">Offaly</option>
    <option value="Roscommon">Roscommon</option>
    <option value="Sligo">Sligo</option>
    <option value="Tipperary">Tipperary</option>
    <option value="Tyrone">Tyrone</option>
    <option value="Waterford">Waterford</option>
    <option value="Westmeath">Westmeath</option>
    <option value="Wexford">Wexford</option>
    <option value="Wicklow">Wicklow</option>
  </optgroup>
</select>
<select class="states-select" data-country="MX">
  <optgroup label="Mexican States">
    <option value="Aguascalientes">Aguascalientes</option>
    <option value="Baja California Norte">Baja California Norte
    </option>
    <option value="Baja California Sur">Baja California Sur</option>
    <option value="Campeche">Campeche</option>
    <option value="Chiapas">Chiapas</option>
    <option value="Chihuahua">Chihuahua</option>
    <option value="Coahuila">Coahuila</option>
    <option value="Colima">Colima</option>
    <option value="Distrito Federal">Distrito Federal</option>
    <option value="Durango">Durango</option>
    <option value="Guanajuato">Guanajuato</option>
    <option value="Guerrero">Guerrero</option>
    <option value="Hidalgo">Hidalgo</option>
    <option value="Jalisco">Jalisco</option>
    <option value="Mexico (Estado de)">Mexico (Estado de)</option>
    <option value="Michoacan">Michoacan</option>
    <option value="Morelos">Morelos</option>
    <option value="Nayarit">Nayarit</option>
    <option value="Nuevo Leon">Nuevo Leon</option>
    <option value="Oaxaca">Oaxaca</option>
    <option value="Puebla">Puebla</option>
    <option value="Queretaro">Queretaro</option>
    <option value="Quintana Roo">Quintana Roo</option>
    <option value="San Luis Potosi">San Luis Potosi</option>
    <option value="Sinaloa">Sinaloa</option>
    <option value="Sonora">Sonora</option>
    <option value="Tabasco">Tabasco</option>
    <option value="Tamaulipas">Tamaulipas</option>
    <option value="Tlaxcala">Tlaxcala</option>
    <option value="Veracruz">Veracruz</option>
    <option value="Yucatan">Yucatan</option>
    <option value="Zacatecas">Zacatecas</option>
  </optgroup>
</select>
<select class="states-select" data-country="ZA">
  <optgroup label="South African Provinces">
    <option value="Eastern Cape">Eastern Cape</option>
    <option value="Free State">Free State</option>
    <option value="Gauteng">Gauteng</option>
    <option value="KwaZulu-Natal">KwaZulu-Natal</option>
    <option value="Limpopo">Limpopo</option>
    <option value="Mpumalanga">Mpumalanga</option>
    <option value="North West">North West</option>
    <option value="Northern Cape">Northern Cape</option>
    <option value="Western Cape">Western Cape</option>
  </optgroup>
</select>
<select class="states-select" data-country="SE">
  <optgroup label="Swedish Provinces">
    <option value="Blekinge">Blekinge</option>
    <option value="Dalarna">Dalarna</option>
    <option value="Gavleborg">Gavleborg</option>
    <option value="Gotland">Gotland</option>
    <option value="Halland">Halland</option>
    <option value="Jamtland">Jamtland</option>
    <option value="Jonkoping">Jonkoping</option>
    <option value="Kalmar">Kalmar</option>
    <option value="Kronoberg">Kronoberg</option>
    <option value="Norrbotten">Norrbotten</option>
    <option value="Orebro">Orebro</option>
    <option value="Ostergotland">Ostergotland</option>
    <option value="Skane">Skane</option>
    <option value="Sodermanland">Sodermanland</option>
    <option value="Stockholm">Stockholm</option>
    <option value="Uppsala">Uppsala</option>
    <option value="Varmland">Varmland</option>
    <option value="Vasterbotten">Vasterbotten</option>
    <option value="Vasternorrland">Vasternorrland</option>
    <option value="Vastmanland">Vastmanland</option>
    <option value="Vastra Gotaland">Vastra Gotaland</option>
  </optgroup>
</select>

</div>
</div>
</div>
<!-- Address Ends -->
<!-- Email -->
<div class="cc-additional-info" id="email-row">
  <div class="row hint-msg-parent">
    <div class="full">
      <div class="field-container">
        <i class="fa fa-envelope field-icon"></i>
        <input type="email" name="email" placeholder="Email" data-parsley-group="page-3" required=""><i class="fa fa-question-circle hint"></i>

        <div class="hint-msg small">
          {{email-info}}
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Email Ends -->
</div>
<!-- = Billing Info Section Ends ==========  -->
<!-- = Privacy Policy Section ==========  -->
<div id="privacy-policy">
  <div class="row cc-additional-info">
    <div class="full">
      <input type="checkbox" name="legal_confirm" id="legalConfirm" data-parsley-group="page-3" data-parsley-errors-container="#privacy-error-msg" data-parsley-error-message="{{pp-acknowledge}}." required=""><label for="legalConfirm">{{privacy-policy}}.</label>
    </div>
  </div>
  <div class="row cc-additional-info error-msg-row">
    <div class="full">
      <div id="privacy-error-msg"></div>
    </div>
  </div>
</div>
<!-- = Privacy Policy Section Ends ==========  -->
<!-- = Submit Button ==========  -->
<div>
  <div class="row">
    <div class="full">
      <button type="submit" class="btn large-label-size" id="donate-btn">
        {{Donate-now}}
      </button>
    </div>
  </div>
</div>
</fieldset>
<!-- = One Line Error Message ==========  -->
<div>
  <div class="row">
    <div class="full" id="one-line-error">
      <p>{{please-complete}}.</p>
    </div>
  </div>
</div>
<!-- = One Line Error Message Ends ==========  -->
<!-- = Submit Button Ends ==========  -->
<input type="hidden" name="bp_load_counter" value="1"/>
<input type="hidden" name="cc_type_cd" value=""/>
<input type="hidden" name="amount" value="other"/>
<input type="hidden" name="amount_other" value=""/>
</form>
</div>
<div class="row">
  <!--(bake-start _if="show_other_ways_to_give")-->
  <p class="other_ways_to_give">
    <small>Other ways to give: <a target="_blank" href="https://sendto.mozilla.org/page/content/give-bitcoin/">Bitcoin</a> | <a target="_blank" href="https://wiki.mozilla.org/Ways_to_Give#Check_.28via_postal_service.29">Check</a></small>
  </p>
  <!--(bake-end)-->
  <p class="need-help">
    <small>{{problems-donating}}</small>
  </p>
  <p class="donation-notice">
    <small>{{donation-notice}}</small>
  </p>
</div>
</div>
</div>
<!-- =================== Above form content ENDS =================== -->

<!-- =================== Below form content STARTS =================== -->

<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top" id="paypal-one-time">
  <input type="hidden" name="cmd" value="_donations">
  <input type="hidden" name="business" value="44ZHAVWJHTK2N">
  <input type="hidden" name="lc" value="{{locale}}">
  <input type="hidden" name="item_name" value="Mozilla Foundation">
  <input type="hidden" name="no_note" value="1">
  <input type="hidden" name="no_shipping" value="1">
  <input type="hidden" name="rm" value="1">
  <input type="hidden" name="custom" value="20140923 eoy14 sequential">
  <!-- Donation Amount -->
  <input type="hidden" name="amount" value="3">
  <input type="hidden" name="return" value="{{return_url}}">
  <input type="hidden" name="currency_code" value="{{currency}}">
  <input type="hidden" name="bn" value="PP-DonationsBF:maker-party-donate-button.png:NonHosted">
</form>

<form action="https://www.paypal.com/cgi-bin/webscr" method="post" id="paypal-recurring">
  <input type="hidden" name="cmd" value="_xclick-subscriptions">
  <input type="hidden" name="business" value="44ZHAVWJHTK2N">
  <input type="hidden" name="lc" value="{{locale}}">
  <input type="hidden" name="item_name" value="Mozilla Foundation Recurring Donation">
  <input type="hidden" name="no_note" value="1">
  <input type="hidden" name="no_shipping" value="2">
  <input type="hidden" name="custom" value="20140923 eoy14 sequential">
  <input type="hidden" name="return" value="{{return_url}}">
  <input type="hidden" name="src" value="1">
  <input type="hidden" name="p3" value="1">
  <input type="hidden" name="currency_code" value="{{currency}}">
  <input type="hidden" name="bn" value="PP-SubscriptionsBF:maker-party-donate-button.png:NonHosted">
  <input type="hidden" name="t3" value="M">
  <input name="srt" type="hidden" value="0">
  <!-- Donation Amount -->
  <input type="hidden" name="a3" value="3">
</form>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://sendto.mozilla.org/page/-/donation_form/js/parsley.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    var
      $bsdForm = $("form#contribution"),
      $theForm = $("#donation-form-sequential"),
      win = window,
      AMOUNT_SET_PARAM = "preset",
      AMOUNT_PRESET = {
        2: [ 100, 50, 25, 15 ]
      };

    // extract query param from url
    // code modified from: http://www.sitepoint.com/url-parameters-jquery/
    $.urlParam = function(name){
      var results =
          new RegExp('[\?&amp;]' + name + '=([^&amp;#]*)').exec(window.location.href);
      return results ? results[1] : null;
    }

    function updateAmountOptions(presetNum) {
      if ( presetNum && AMOUNT_PRESET[presetNum] ) {
        $("input[name='donation_amount']").each(function(idx) {
          if ( $(this).attr("id") == "amount-other" ) {
            return;
          }
          var selectedPreset = AMOUNT_PRESET[presetNum];
          var newAmount = selectedPreset[idx];
          $(this).attr({
            id: "amount-" + newAmount,
            value: newAmount
          });
          $(this).siblings("label").attr({
            for: $(this).attr("id")
          });
          $(this).siblings("label").text("$" + newAmount);
        });
      }
      // amount options have been updated, now show them to users
      $(".row.donation-amount-row").removeClass("hidden-visibility");
    }

    updateAmountOptions( $.urlParam(AMOUNT_SET_PARAM) );

    // ***********************************************
    // Preselect dollar amount
    // ***********************************************
    function processAmountHash(winLocationHash) {
      var amtRegex = /#amount-([\w\.]+)/;
      var amount = winLocationHash.match(amtRegex)[1];
      if ($(winLocationHash)[0]) {
        $(winLocationHash)[0].checked = true;
        $('input[name="donation_amount_other"]').val("");
      } else {
        $("#amount-other")[0].checked = true;
        $('input[name="donation_amount_other"]').val(amount);
      }
      history.replaceState({page: 1, hash: '#page-1'}, '', '#page-1');
      updateDonateButtonText(amount);
    }

    $(win).on('load', function () {
      var winLocationHash = win.location.hash;
      if (winLocationHash.match(/#amount-\d+?/)) {
        processAmountHash(winLocationHash);
      } else if (winLocationHash.match(/#cc-amount-\d+?/)) {
        winLocationHash = winLocationHash.replace("cc-", "");
        processAmountHash(winLocationHash);
        history.pushState({page: 2, hash: '#page-2'}, '', '#page-2');
        $('#payment-cc').prop('checked', true);
        showCreditCardForm();
        hidePage('#page-1', 'complete');
        showPage('#page-2');
      } else {
        history.replaceState({page: 1, hash: '#page-1'}, '', '#page-1');
      }
    });


    // ***********************************************
    // UI related
    // ***********************************************
    $bsdForm.hide();
    $(".cc-additional-info").hide();
    $(".hint-msg").hide();

    $("#donation-form input, #donation-form select").focus(function() {
      $(this).siblings("i.fa.field-icon").addClass("icon-in-focus");
    });
    $("#donation-form input, #donation-form select").blur(function() {
      $(this).siblings("i.fa.field-icon").removeClass("icon-in-focus");
    });

    // Clickable progress dot
    $(".progress").on("click", "li", function() {
      var dotSelected = $(this).data("position").replace("#page-","");
      var currentPage = $(".progress li.active").data("position").replace("#page-","");
      if ( dotSelected < currentPage ) {
        window.history.go(dotSelected-currentPage);
        if ( dotSelected-currentPage == -2 ) {
          hidePage('#page-3', 'incomplete');
        }
      }
    });

    function calculateHeight() {
      if (!win.location.hash) {
        return;
      }
      $('#donation-form-sequential').height($(win.location.hash).height() + 145);
    }

    function showCreditCardForm() {
      $(".cc-additional-info").slideDown(100);
      win.setTimeout(function() {
        calculateHeight();
        $('[name="cc_number"]').focus();
      }, 100);
      if ( $(".parsley-error").length > 0 ) {
        $("#one-line-error").show();
      }
    }

    $("#payment-type-row label").click(function() {
      // reset
      $(".cc-additional-info").hide();
      // toggle corresponding section
      var paymentType = $(this).attr("for");
      if (paymentType == "payment-cc") {
        showCreditCardForm();
      } else {
        calculateHeight();
        $("#one-line-error").hide();
        if ($('[name="recurring_acknowledge"]:checked').val() === '0') {
          $('#paypal-one-time').submit();
        } else {
          $('#paypal-recurring').submit();
        }
      }
    });

    $(win).on('resize', calculateHeight);

    $("input#amount-other + label + input[name='donation_amount_other']").focus(function() {
      $(this).prevAll("input[type='radio']").click();
    });

    $("i.hint").click(function() {
      $(this).toggleClass("on");
      $(this).parents(".hint-msg-parent").find(".hint-msg").toggle();
      calculateHeight();
    });


    // ***********************************************
    // Generate state & country dropdown.
    // This basically copies the BSD generated DOM.
    // ***********************************************
    function generateStateDropdown() {
      var selectedCountry = $theForm.find("select[name='country']").val();
      var optgroup = $("select[data-country='" + selectedCountry + "'] optgroup");
      var stateDropdown = $theForm.find('select[name="state_cd"]');
      stateDropdown.find("optgroup").remove();
      stateDropdown.removeClass("normalTextColor");
      stateDropdown.find("option[data-value='none']").remove();
      if (optgroup.length) {
        stateDropdown.val("");
        stateDropdown.append(optgroup.clone());
        stateDropdown.prop("required", true);
        stateDropdown.show();
      } else {
        var noneoptions = $("select[data-country='none'] option");
        var clonedOptions = noneoptions.clone();
        stateDropdown.append(clonedOptions);
        stateDropdown.find("option:selected").removeAttr("selected");
        clonedOptions.prop("selected", true);
        stateDropdown.prop("required", false);
        stateDropdown.hide();
      }
    }


    function generateCountryDropdown() {
      var cloned = $bsdForm.find("select[name='country']").clone();
      $theForm.find("select[name='country']").html(cloned.html());
      $theForm.find("select[name='country'] option:selected").removeAttr("selected");
      $theForm.find("select[name='country'] option:first-child").html("Country");
      $theForm.find("select[name='country']").val("US").addClass("normalTextColor");
      $theForm.find("select[name='country']").change(function (){
        var selected = $(this).val();
        generateStateDropdown();
        if ( selected ){
          $(this).addClass("normalTextColor");
        } else {
          $(this).removeClass("normalTextColor");
        }
      });
    }
    generateCountryDropdown();
    generateStateDropdown();

    $theForm.find('select[name="state_cd"]').change(function () {
      var selected = $(this).val();
      if ( selected ){
        $(this).addClass("normalTextColor");
      } else {
        $(this).removeClass("normalTextColor");
      }
    });


    // ***********************************************
    // Extract BSD form meta and insert to our form
    // ***********************************************
    function insertFormMetaDOM() {
      // the following is an array of all the meta form field names that came with the BSD generated form
      // API doc here: https://github.com/bluestatedigital/bsd-developer-docs/blob/master/bsd-donate-api/README.md
      var bsdFormMetaName = [
                          "slug",
                          "submission_key",
                          "http_referer",
                          "event_attendee_id",
                          "outreach_page_id",
                          "stg_signup_id",
                          "mailing_link_id",
                          "mailing_recipient_id",
                          "match_campaign_id",
                          "match_is_pledge",
                          "pledge_is_convert",
                          "contributor_key",
                          "quick_donate_populated",
                          "device_fingerprint",
                          "default_country",
                          "cc_number_ack",
                          "ach_account_number_ack",
                          "k-ris-sid",
                        ];

      $.each(bsdFormMetaName, function( index, value ) {
        $theForm.prepend($bsdForm.find("[name='" + value + "']").clone());
      });

    }
    insertFormMetaDOM();


    // ***********************************************
    // Remove the BSD generated form from DOM
    // ***********************************************
    $bsdForm.remove();

    // ***********************************************
    // Update Donate button to make it show the selected donation amount
    // ***********************************************
    var updateDonateButtonText = function(amountSelected) {
      var buttonText;
      if ( amountSelected == "other" ) {
        amountSelected = $theForm.find("[name='donation_amount_other']").val();
      }
      var locale = "{{locale}}";
      if (amountSelected && locale === "US") {
        buttonText = "Donate $" + amountSelected + " now";
      } else {
        buttonText = "{{Donate-now}}";
      }
      $("#donate-btn").text(buttonText);
      $('#paypal-one-time').find('[name="amount"]').attr('value', amountSelected);
      $('#paypal-recurring').find('[name="a3"]').attr('value', amountSelected);
    };

    $theForm.find("[name='donation_amount']").change(function() {
      updateDonateButtonText($(this).val());
    });
    $theForm.find("[name='donation_amount']").change(function (e) {
      if ($(this).val() !== 'other') {
        $('input[name="donation_amount_other"]').attr('required', false).attr('data-parsley-required',"false");
      }
    });

    $theForm.find("[name='donation_amount_other']").keyup(function() {
      updateDonateButtonText($(this).val());
    });
    $theForm.find("[name='donation_amount']").change(function() {
      $theForm.find("[name='donation_amount_other']").val("");
    });
    $theForm.find("[name='donation_amount_other']").keydown(function(event) {
      var functionKeys = [ 8, 9, 13, 27, 37, 39, 46, 110, 190]; // backspace, tab, enter, escape, left arrow, right arrow, delete, decimal point, period
      var numberKeys = [ 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105 ]; // numbers
      var allowed = functionKeys.concat(numberKeys);
      if ( allowed.indexOf(event.keyCode) === -1 ) {
        event.preventDefault();
      }
    });

    // ***********************************************
    // Program next links and back button
    // ***********************************************

    function hidePage(page, status) {
      $(page).addClass('page-hidden-' + status).prop('disabled', true);
      var amount;
      if (page === "#page-1") {
        if (status === "complete") {
          amount = "$" + $('#paypal-one-time').find('[name="amount"]').attr('value');
          $("[data-position='#page-1'] .page-breadcrumb").text(amount);
        } else {
          $("[data-position='#page-1'] .page-breadcrumb").text("");
        }
      } else if (page === "#page-2") {
        if (status === "complete") {
          $("[data-position='#page-2'] .page-breadcrumb").text("{{Credit-card}}");
        } else {
          $("[data-position='#page-2'] .page-breadcrumb").text("");
        }
      }
      win.setTimeout(function () {
        $(page).addClass('hidden')
      }, 501);
    }

    function showPage(page) {
      $('ol.progress').find('li').removeClass('active');
      $('ol.progress').find('li[data-position="' + page +'"]').addClass('active');

      $("[data-position='" + page + "'] .page-breadcrumb").text("");

      $(page).removeClass('hidden');
      win.setTimeout(function () {
        $(page).removeClass('page-hidden-incomplete').removeClass('page-hidden-complete').prop('disabled', false);
      }, 100);

      calculateHeight();

      // Reset progress bar dots' cursor type accordlying
      $(".progress li").css({ cursor: "default" });
      $(".progress li.active").prevAll("li").css({ cursor: "pointer" });
    }

    $theForm.on('click', '[data-button-type="next"]', function (e) {
      e.preventDefault();
      $('#one-line-error').hide();

      if ($('input[name="donation_amount"]:checked').val() === 'other') {
        $('input[name="donation_amount_other"]').attr('required', true);
      }

      var
          $context = $(this),
          current = $context.data('page'),
          next = current + 1;
      if ($theForm.parsley().isValid('page-' + current)) {
        history.pushState({hash: '#page-' + next, page: next}, '', $context.prop('href'));
        hidePage('#page-' + current, 'complete');
        showPage('#page-' + next);
      } else {
        $theForm.parsley().validate('page-' + current);
        calculateHeight();
      }
    });

    win.onpopstate = function (e) {

      $('#one-line-error').hide();
      if (e.state.page !== null) {
        hidePage('#page-' + (e.state.page - 1), 'complete');
        hidePage('#page-' + (e.state.page + 1), 'incomplete');
      } else {
        hidePage('#page-2', 'incomplete');
        hidePage('#page-3', 'incomplete');
      }
      history.replaceState({page: e.state.page, hash: e.state.hash}, '', e.state.hash);
      showPage(e.state.hash);
    };

    // ***********************************************
    // Parsley.js setting & client side validation etc
    // API: http://parsleyjs.org/doc/
    // ***********************************************
    var regVisa = /^(?:4[0-9]{12}(?:[0-9]{3})?)$/;
    var regMC = /^(?:5[1-5][0-9]{14})$/;
    var regAMEX = /^(?:3[47][0-9]{13})$/;

    win.ParsleyConfig = {};

    win.ParsleyValidator
      // Check `other amount` is valid
      .addValidator('checkAmount', function (value, requirement) {
        // 2 decimals places; allows leading 0 (eg. 0.12);
        var reg = /^\s*-?(\d+(\.\d{1,2})?|\.\d{1,2})\s*$/;
        console.log(requirement);
        return (value.match(reg) && value.match(reg).length > 0 );
      }, 10)
      .addMessage("en", "checkAmount", "{{Other-amount-format-error}}")
      // Visa and Master Card client side validation
      .addValidator('visaMcCardNum', function (value, requirement) {
        return (value.match(regVisa) && value.match(regVisa).length > 0 )
                || (value.match(regMC) && value.match(regMC).length > 0 )
                || (value.match(regAMEX) && value.match(regAMEX).length > 0);
      }, 10)
      // Credit card expirary date validation
      .addValidator('ccExpirary', function (value, requirement) {
        var reg = /(0[1-9]|1[0-2])\/[0-9]{2}/;
        return (value.match(reg) && value.match(reg).length > 0 );
      }, 10);


    $theForm.parsley().subscribe('parsley:form:validated', function (formInstance) {
      $('#one-line-error').hide();
      calculateHeight();
      if (formInstance.submitEvent !== undefined) {
        formInstance.submitEvent.preventDefault();
      }
      if (!formInstance.isValid()) {
        if ( $("#payment-type-row input:checked").val() !== "paypal" ) {
          $('#one-line-error').show();
        }
      } else {
        var
            $donateButton = $('#donate-btn'),
            donateButtonText = $donateButton.text();

        $('#page-1').add('#page-2').removeClass('hidden').attr('disabled', false);

        function hidePages() {
          $('#page-1').add('#page-2').addClass('hidden').attr('disabled', true);
        }

        $donateButton.prop('disabled', true).html('<i class="fa fa-cog fa-spin"/> {{Submitting}}');

        function prepDonationAmount() {
          // Set donation amount hidden inputs so all APIs are happy
          var selected;
          if ($('input[name="donation_amount_other"]').val() !== '') {
            selected = $('input[name="donation_amount_other"]').val();
          } else {
            selected = $('input[name="donation_amount"]:checked').val()
          }
          $('input[name="amount_other"]').attr('value', selected);
        }

        prepDonationAmount();


        function findCCType(ccNum) {
          if (ccNum.match(regVisa)) {
            return 'vs';
          } else if (ccNum.match(regMC)) {
            return 'mc';
          } else if (ccNum.match(regAMEX)) {
            return 'ax';
          } else {
            return null;
          }
        }

        $('input[name="cc_type_cd"]').attr('value', findCCType($('input[name="cc_number"]').val()));

        function submission400s(XHR, textStatus, error) {
          switch (XHR.responseJSON.code) {
          case 'duplicate':
            $('#one-line-error').text("{{dupe-donation}}").show();
            break;
          case 'unknown':
            $('#one-line-error').text("{{transaction-try-another}}").show();
            break;
          case 'gateway':
            switch (XHR.responseJSON.gateway_response.status) {
            case 'decline':
              $('#one-line-error').text("{{declined-card}}").show();
              break;
            case 'failure':
              $('#one-line-error').text("{{fraud-card}}").show();
              break;
            default :
              $('#one-line-error').text("{{gone-wrong-try-another}}").show();
            }
            break;
          case 'validation':
            if (XHR.responseJSON.field_errors.length) {
              switch (XHR.responseJSON.field_errors[0].field) {
              case 'cc_number':
                $('#one-line-error').text("{{Invalid-number}}").show();
                break;
              case 'zip':
                $('#one-line-error').text("{{Invalid-zip}}").show();
                break;
              case 'cc_cvv':
                $('#one-line-error').text("{{Invalid-CVC}}").show();
                break;
              case 'cc_expir_group':
                $('#one-line-error').text("{{expired-card}}").show();
                break;
              default :
                $('#one-line-error').text("{{gone-wrong-try-another}}").show();
              }
              break;
            }
            break;
          default :
            $('#one-line-error').text("{{try-again-later}}").show();
          }
          hidePages();
        }

        var submitDonation = $.ajax('/page/cde/Api/Charge/v1', {
          type: 'POST',
          data: $theForm.serializeArray(),
          statusCode: {
            400: submission400s,
            500: function (XHR, textStatus, error) {
              $('#one-line-error').text("{{try-again-later}}").show();
              hidePages();
            }
          }
        });

        function submitSuccess(data, textStatus, XHR) {
          if (win.location.assign) {
            win.location.assign(data.redirect_url);
          } else {
            win.location = data.redirect_url;
          }
        }

        function submitError(XHR, textStatus, error) {
          $donateButton.prop('disabled', false).text(donateButtonText);
        }

        submitDonation.error(submitError).success(submitSuccess);

        $("#one-line-error").hide();
      }
    });
  });
</script>
<!-- =================== Below form content ENDS =================== -->
