<!-- =================== Below form content STARTS =================== -->

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://sendto.mozilla.org/page/-/protect-net-neutrality/js/parsley.min.js"></script>
<script>

(function(){
  var $bsdForm = $("#signup"); // BSD autogenerated form
  var $theForm = $("#mailinglist-signup-form"); // our beautified form
  var REDIRECT_URL = "https://sendto.mozilla.org/page/content/FCCvote-net-neutrality-share"; // no way to this value from BSD directly, have to use hardcoded url here

  // ***********************************************
  // Extract query param from url
  // code modified from: http://www.sitepoint.com/url-parameters-jquery/
  // ***********************************************
  $.urlParam = function(name){
    var results =
        new RegExp('[\?&amp;]' + name + '=([^&amp;#]*)').exec(window.location.href);
    return results ? results[1] : null;
  }

  // ***********************************************
  // Remove the BSD generated form from DOM
  // ***********************************************
  $(window).on("load", function () {
    $bsdForm.remove();
    var carriedEmail = $.urlParam("email");
    if ( carriedEmail) {
      $("#mailinglist-signup-form").find("input[name='email']").attr("value",carriedEmail);
    }
  });

  // ***********************************************
  // Parsley Settings, Form Validation, & Form Validation
  // ***********************************************

  $theForm.parsley().subscribe('parsley:form:validated', function (formInstance) {
    if (formInstance.submitEvent !== undefined) {
      formInstance.submitEvent.preventDefault();
    }
    if (!formInstance.isValid()) {
      formInstance.submitEvent.preventDefault();
    } else {
      // ***********************************************
      // Form Submission
      // ***********************************************

      function submissionErrorHandler(XHR, textStatus, error) {
        $('#one-line-error').text("Something seems to have gone wrong. Please try again later").show();
      }

      function submitSuccess(data, textStatus, XHR) {
        if (window.location.assign) {
          window.location.assign(REDIRECT_URL);
        } else {
          window.location = REDIRECT_URL;
        }
      }

      function submitError(XHR, textStatus, error) {
      }

      console.log($theForm.serialize());

      var submitTheForm = $.ajax($theForm.prop("action"), {
        type: "POST",
        data: $theForm.serialize(),
        statusCode: {
          400: submissionErrorHandler,
          500: submissionErrorHandler
        }

      });

      submitTheForm.error(submitError).success(submitSuccess);
    }
  });



})();

</script>


<!-- =================== Below form content ENDS =================== -->
