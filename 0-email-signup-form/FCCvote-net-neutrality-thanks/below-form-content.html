<!-- =================== Below form content STARTS =================== -->

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://sendto.mozilla.org/page/-/protect-net-neutrality/js/parsley.min.js"></script>
<script>

(function(){
  var $bsdForm = $("#signup"); // BSD autogenerated form
  var $theForm = $("#mailinglist-signup-form"); // our beautified form
  var REDIRECT_URL = "https://sendto.mozilla.org/page/content/FCCvote-net-neutrality-share"; // no way to get this value from BSD directly, have to use hardcoded url here
  var sparams = window.location.search;
  var queryParams = {};

  // ***********************************************
  // Extract query param from url
  // ***********************************************
  if ( sparams.indexOf("?") === 0 ) {
    var pairs = sparams.substring(1).split("&");
    pairs.forEach(function(p) {
      var terms = p.split("=");
      queryParams[ terms[0] ] = terms[1];
    });
  }

  // ***********************************************
  // Remove the BSD generated form from DOM
  // ***********************************************
  $(window).on("load", function () {
    $bsdForm.remove();
    var carriedEmail = queryParams["email"];
    if ( carriedEmail ) {
      $("#mailinglist-signup-form").find("input[name='email']").attr("value",carriedEmail);
    }
  });

  // ***********************************************
  // Parsley Settings, Form Validation, & Form Validation
  // ***********************************************

  $theForm.parsley().subscribe('parsley:form:validated', function (formInstance) {
    if (formInstance.submitEvent !== undefined) {
      formInstance.submitEvent.preventDefault();
    }
    if (!formInstance.isValid()) {
      formInstance.submitEvent.preventDefault();
    } else {
      // ***********************************************
      // Form Submission
      // ***********************************************

      function submissionErrorHandler(XHR, textStatus, error) {
        $('#one-line-error').text("Something seems to have gone wrong. Please try again later").show();
      }

      function submitSuccess(data, textStatus, XHR) {
        if (window.location.assign) {
          window.location.assign(REDIRECT_URL);
        } else {
          window.location = REDIRECT_URL;
        }
      }

      function submitError(XHR, textStatus, error) {
      }

      var submitTheForm = $.ajax($theForm.prop("action"), {
        type: "POST",
        data: $theForm.serialize(),
        statusCode: {
          400: submissionErrorHandler,
          500: submissionErrorHandler
        }

      });

      submitTheForm.error(submitError).success(submitSuccess);
    }
  });



})();

</script>


<!-- =================== Below form content ENDS =================== -->
